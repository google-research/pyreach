# Copyright 2021 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import json

from pyreach.common.proto_gen import logs_pb2
from pyreach.common.python import types_gen
import unittest


class TypesGenTest(unittest.TestCase):

  def test_convert_empty(self) -> None:
    dd = types_gen.DeviceData()
    json_obj = dd.to_json()
    self.assertEqual(json_obj, {})
    dd_proto = logs_pb2.DeviceData()
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {})

  def test_convert_simple(self) -> None:
    dd_proto = logs_pb2.DeviceData()
    dd_proto.device_type = 'robot'
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {'deviceType': 'robot'})

  def test_convert_timestamp(self) -> None:
    dd_proto = logs_pb2.DeviceData()
    dd_proto.ts.seconds = 1
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {'ts': 1000})

  def test_convert_duration(self) -> None:
    cd_proto = logs_pb2.CommandData()
    cd_proto.event_duration.seconds = 1
    cd_proto.event_duration.nanos = 2
    cd = types_gen.CommandData.from_proto(cd_proto)
    self.assertEqual(cd.to_json(), {'eventDuration': 1.000000002})

  def test_convert_flatten(self) -> None:
    dd_proto = logs_pb2.DeviceData()
    dd_proto.color.color = 'color_file'
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {'color': 'color_file'})

  def test_convert_legacy(self) -> None:
    dd_proto = logs_pb2.DeviceData()
    dd_proto.ur_state.pose[:] = [1, 2, 3]
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {'pose': [1.0, 2.0, 3.0]})

  def test_convert_nested(self) -> None:
    dd_proto = logs_pb2.DeviceData()
    dd_proto.audio_request_mute.text_cue = 'abc'
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {'audioRequestMute': {'textCue': 'abc'}})

  def test_oneof(self) -> None:
    dd_proto = logs_pb2.DeviceData()
    dd_proto.audio_request_mute.text_cue = 'abc'
    dd_proto.audio_request_unmute.text_cue = 'def'
    dd = types_gen.DeviceData.from_proto(dd_proto)
    self.assertEqual(dd.to_json(), {'audioRequestUnmute': {'textCue': 'def'}})

  def test_snapshot(self) -> None:
    cd_proto = logs_pb2.CommandData()
    cd_proto.device_type = 'robot'
    cd_proto.data_type = 'reach-script'
    cd_proto.reach_script.preemptive = True
    cd_proto.snapshot.device_data_refs.add().ts.seconds = 1
    cd_proto.snapshot.device_data_refs.add().seq = 2
    cd_proto.snapshot.gym_actions.add().device_type = 'robot'
    cd_proto.snapshot.gym_actions[0].arm_action_params.command = 1
    cd = types_gen.CommandData.from_proto(cd_proto)
    self.assertEqual(
        cd.to_json(), {
            'dataType': 'reach-script',
            'deviceType': 'robot',
            'reachScript': {
                'preemptive': True
            },
            'snapshot': {
                'deviceDataRefs': [{
                    'ts': 1000
                }, {
                    'seq': 2
                }],
                'gymActions': [{
                    'armActionParams': {
                        'command': 1
                    },
                    'deviceType': 'robot'
                }]
            }
        })

  def test_device_data_protoloop(self) -> None:
    tests = [
        """{"deviceType":"color-camera","dataType":"color","inhibitFrameSend":true,"inhibitFrameSave":true,"ts":1633568210582,"experimentToken":"CAMSAA","seq":449954,"color":"image__00082347.jpg"}""",
        """{"deviceType":"color-camera","dataType":"color","inhibitFrameSend":true,"inhibitFrameSave":true,"ts":1633568210589,"experimentToken":"CAMSAA","seq":449955,"color":"image__00082348.jpg"}""",
        """{"deviceType":"robot","dataType":"robot-state","sendToClients":[{"uid":"1274f7f5-45ad-4a6a-a2ef-6fb07d80e369"}],"ts":1633568210660,"experimentToken":"CAMSAA","seq":449956,"pose":[0.13983504026099816,-0.669070468336733,0.11754255108996566,0.0474638892526731,-3.119277861389985,0.00034333736967873276],"joints":[1.5835976600646973,-0.8476508420756836,1.5862677733050745,-2.3076092205443324,4.690121173858643,-0.018304173146383107],"force":[24.735927638490846,19.238394202166365,19.23937734313005,-1.0049576203399004,0.7245889062027597,-0.11411488801738409],"isRobotPowerOn":true,"safetyMessage":"NORMAL","isProgramRunning":true,"digitalIn":[false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"sensorIn":[false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"digitalOut":[false,false,false,false,false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"analogIn":[1.0410845279693604,0.3925156593322754],"analogOut":[0.004000000189989805,0.004000000189989805],"toolDigitalIn":[false,false],"toolDigitalOut":[false,false],"toolAnalogIn":[0.02740962989628315,0.01713101752102375],"boardTempC":35.9375,"robotVoltageV":47.72718811035156,"robotCurrentA":0.05706680938601494,"toolTempC":32.75,"toolCurrentA":0.016618967056274414,"jointVoltagesV":[47.570594787597656,47.71392822265625,47.570594787597656,47.5275993347168,47.6279296875,47.570594787597656],"jointCurrentsA":[0.21738068759441376,-5.337092876434326,-0.7564847469329834,-0.19725120067596436,0.12076812982559204,0.0689178854227066],"jointTempsC":[33.375,34.8125,31,33.0625,35.1875,35.5],"robotMode":"remote","programCounter":784,"digitalBank":[{"space":"standard","output":true,"state":[false,false,false,false,false,false,false,false]},{"space":"standard","state":[false,false,false,false,true,false,false,false]},{"space":"configurable","output":true,"state":[true,true,false,false,false,false,false,false]},{"space":"configurable","state":[false,false,false,false,false,false,false,false]},{"space":"tool","output":true,"state":[false,false]},{"space":"tool","state":[false,false]}],"analogBank":[{"space":"standard","output":true,"state":[0.004000000189989805,0.004000000189989805]},{"space":"standard","state":[1.0410845279693604,0.3925156593322754]},{"space":"tool","state":[0.02740962989628315,0.01713101752102375]}],"lastTerminatedProgram":"19d677e9-05b0-4d8f-9fdd-ab146afd012c"}""",
        """{"deviceType":"robot","dataType":"ur-state","sendToClients":[{"uid":"1274f7f5-45ad-4a6a-a2ef-6fb07d80e369"}],"ts":1633568210660,"experimentToken":"CAMSAA","seq":449956,"pose":[0.13983504026099816,-0.669070468336733,0.11754255108996566,0.0474638892526731,-3.119277861389985,0.00034333736967873276],"joints":[1.5835976600646973,-0.8476508420756836,1.5862677733050745,-2.3076092205443324,4.690121173858643,-0.018304173146383107],"force":[24.735927638490846,19.238394202166365,19.23937734313005,-1.0049576203399004,0.7245889062027597,-0.11411488801738409],"isRobotPowerOn":true,"safetyMessage":"NORMAL","isProgramRunning":true,"digitalIn":[false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"sensorIn":[false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"digitalOut":[false,false,false,false,false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"analogIn":[1.0410845279693604,0.3925156593322754],"analogOut":[0.004000000189989805,0.004000000189989805],"toolDigitalIn":[false,false],"toolDigitalOut":[false,false],"toolAnalogIn":[0.02740962989628315,0.01713101752102375],"boardTempC":35.9375,"robotVoltageV":47.72718811035156,"robotCurrentA":0.05706680938601494,"toolTempC":32.75,"toolCurrentA":0.016618967056274414,"jointVoltagesV":[47.570594787597656,47.71392822265625,47.570594787597656,47.5275993347168,47.6279296875,47.570594787597656],"jointCurrentsA":[0.21738068759441376,-5.337092876434326,-0.7564847469329834,-0.19725120067596436,0.12076812982559204,0.0689178854227066],"jointTempsC":[33.375,34.8125,31,33.0625,35.1875,35.5],"robotMode":"remote","programCounter":784,"digitalBank":[{"space":"standard","output":true,"state":[false,false,false,false,false,false,false,false]},{"space":"standard","state":[false,false,false,false,true,false,false,false]},{"space":"configurable","output":true,"state":[true,true,false,false,false,false,false,false]},{"space":"configurable","state":[false,false,false,false,false,false,false,false]},{"space":"tool","output":true,"state":[false,false]},{"space":"tool","state":[false,false]}],"analogBank":[{"space":"standard","output":true,"state":[0.004000000189989805,0.004000000189989805]},{"space":"standard","state":[1.0410845279693604,0.3925156593322754]},{"space":"tool","state":[0.02740962989628315,0.01713101752102375]}],"lastTerminatedProgram":"19d677e9-05b0-4d8f-9fdd-ab146afd012c"}""",
        """{"deviceType":"vacuum","dataType":"output-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449961,"state":[{}]}""",
        """{"deviceType":"blowoff","dataType":"output-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449962,"state":[{}]}""",
        """{"deviceType":"vacoff-blowon","dataType":"output-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449963,"state":[{"intValue":-1}]}""",
        """{"deviceType":"vacuum-pressure","dataType":"sensor-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449964,"state":[{}]}""",
        """{"deviceType":"vacuum-gauge","dataType":"sensor-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449965,"state":[{"floatValue":1037.3843312263489}]}""",
        """{"deviceType":"robot","dataType":"robot-power-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449960,"robotPowerState":{"isRobotPowerOn":true}}""",
        """{"deviceType":"robot","dataType":"emergency-stop-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449959}""",
        """{"deviceType":"robot","dataType":"safeguard-stop-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449958,"safetyMessage":"NORMAL"}""",
        """{"deviceType":"robot","dataType":"protective-stop-state","ts":1633568210660,"experimentToken":"CAMSAA","seq":449957}""",
        """{"deviceType":"vnc","deviceName":"vnc0","dataType":"color","inhibitFrameSend":true,"inhibitFrameSave":true,"ts":1633568210644,"experimentToken":"CAMSAA","seq":449966,"color":"vnc-color-vnc0-1633568210644.jpg"}""",
        """{"deviceType":"depth-camera","dataType":"color-depth","sendToClients":[{"uid":"1274f7f5-45ad-4a6a-a2ef-6fb07d80e369"}],"ts":1633568876419,"experimentToken":"CAMSAA","seq":540938,"color":"photoneo-color-1633568876419939.jpg","depth":"photoneo-depth-1633568876419939.pgm","uploadDepth":"/tmp/reach2021-10-06T17-01-52-PDT598175397/2021-10-06T17-01-52-PDT/depth-camera/photoneo-depth-1633568876419939.pgm.bz2","uncompressedDepth":"/tmp/reach2021-10-06T17-01-52-PDT598175397/2021-10-06T17-01-52-PDT/depth-camera/photoneo-depth-1633568876419939.pgm","compressedDepth":[{"depth":"/tmp/reach2021-10-06T17-01-52-PDT598175397/2021-10-06T17-01-52-PDT/depth-camera/photoneo-depth-1633568876419939.pgm.bz2","encodings":["bzip2"]}]}""",
        """{"deviceType":"server","dataType":"metric","ts":1633568935005,"experimentToken":"CAMSAA","messageLastTimestamps":[{"deviceType":"vacuum-gauge","dataType":"sensor-state","LastTS":1633568934908},{"deviceType":"vacuum-gauge","dataType":"device-status","LastTS":1633568933200},{"deviceType":"calibration-score","dataType":"key-value","key":"score","LastTS":1633567952416},{"deviceType":"photoneo","dataType":"downlink-status","LastTS":1633568875434},{"deviceType":"blowoff","dataType":"output-state-update","LastTS":1633568933199},{"deviceType":"blowoff","dataType":"output-state","LastTS":1633568934908},{"deviceType":"server","deviceName":"manual-intervention-detector","dataType":"metric","LastTS":1633564913757},{"deviceType":"server","dataType":"metric","LastTS":1633568935005},{"deviceType":"server","dataType":"health","LastTS":1633568813891},{"deviceType":"color-camera","dataType":"color","LastTS":1633568934988},{"deviceType":"oracle","deviceName":"pick-points","dataType":"downlink-status","LastTS":1633568875441},{"deviceType":"oracle","deviceName":"pick-points","dataType":"device-status","LastTS":1633568929320},{"deviceType":"oracle","deviceName":"pick-points","dataType":"prediction","LastTS":1633568934330},{"deviceType":"oracle","deviceName":"pick-place-success","dataType":"downlink-status","LastTS":1633568875438},{"deviceType":"oracle","deviceName":"pick-place-success","dataType":"device-status","LastTS":1633568925397},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-106","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-150","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-302","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-315","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"robot-name","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-136","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-148","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-313","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-124","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-130","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-141","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-999","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-115","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-118","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-137","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-308","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell-tasks","LastTS":1633564914456},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell_constraints.json","LastTS":1633564920364},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell_io.json","LastTS":1633564914168},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-101","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-138","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-146","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-152","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-135","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-305","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-309","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-311","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-143","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/ikhints","LastTS":1633564914277},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-123","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-999999999","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-9999999999","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"assembly.json","LastTS":1633564914338},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/workcell_io","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-120","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-307","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-312","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"version.json","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"actionsets.json","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-112","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-114","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-116","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-132","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-140","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-147","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-107","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-104","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-117","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-119","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-126","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-129","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-133","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-144","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"build-info","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-306","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-451","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-94","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-304","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-301","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-131","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-110","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-127","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-128","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-149","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-310","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-314","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/workcell","LastTS":1633564914282},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-151","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-3","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-93","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell_setup.json","LastTS":1633564914338},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-142","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-109","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-121","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-145","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"calibration.json","LastTS":1633564920364},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-113","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-303","LastTS":1633564913538},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/layouts","LastTS":1633564914282},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/client","LastTS":1633564914282},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-122","LastTS":1633564915192},{"deviceType":"settings-engine","dataType":"key-value","key":"display-name","LastTS":1633564913630},{"deviceType":"settings-engine","dataType":"history","key":"actionsets.json","LastTS":1633564914277},{"deviceType":"vacuum","dataType":"output-state","LastTS":1633568934908},{"deviceType":"vacuum","dataType":"output-state-update","LastTS":1633568932697},{"deviceType":"vacuum-pressure","dataType":"sensor-state","LastTS":1633568934908},{"deviceType":"vacuum-pressure","dataType":"sensor-state-update","LastTS":1633568932697},{"deviceType":"vacuum-pressure","dataType":"key-value","key":"failure","LastTS":1633568739781},{"deviceType":"vacuum-pressure","dataType":"key-value","key":"success","LastTS":1633568932697},{"deviceType":"session-manager","dataType":"connected-clients","LastTS":1633564915109},{"deviceType":"depth-camera","dataType":"color-depth","LastTS":1633568933440},{"deviceType":"operator","deviceName":"4AD9F6","dataType":"cmd-status","LastTS":1633564915109},{"deviceType":"operator","deviceName":"4AD9F6","dataType":"session-info","LastTS":1633564915109},{"deviceType":"operator","dataType":"output-state-update","LastTS":1633568740412},{"deviceType":"vnc","deviceName":"vnc0","dataType":"color","LastTS":1633568934723},{"deviceType":"discovery-aggregator","dataType":"pipeline-description","LastTS":1633564935285},{"deviceType":"discovery-aggregator","dataType":"machine-interfaces","LastTS":1633564935285},{"deviceType":"robot","dataType":"robot-state","LastTS":1633568934908},{"deviceType":"robot","dataType":"robot-power-state-update","LastTS":1633564913757},{"deviceType":"robot","dataType":"safeguard-stop-state","LastTS":1633568934908},{"deviceType":"robot","dataType":"safeguard-stop-state-update","LastTS":1633564913409},{"deviceType":"robot","dataType":"protective-stop-state-update","LastTS":1633564913409},{"deviceType":"robot","dataType":"key-value","key":"robot_constraints.json","LastTS":1633564913654},{"deviceType":"robot","dataType":"emergency-stop-state","LastTS":1633568934908},{"deviceType":"robot","dataType":"emergency-stop-state-update","LastTS":1633564913409},{"deviceType":"robot","dataType":"protective-stop-state","LastTS":1633568934908},{"deviceType":"robot","dataType":"cmd-status","LastTS":1633568934562},{"deviceType":"robot","dataType":"robot-power-state","LastTS":1633568934908},{"deviceType":"metrics","deviceName":"quality","dataType":"device-status","LastTS":1633565059973},{"deviceType":"ping","dataType":"cmd-status","LastTS":1633568933358},{"deviceType":"label-engine","dataType":"pick-label","LastTS":1633568934542},{"deviceType":"object-detector","dataType":"downlink-status","LastTS":1633568875443},{"deviceType":"object-detector","dataType":"health-check","LastTS":1633568933838},{"deviceType":"vacoff-blowon","dataType":"output-state","LastTS":1633568934908},{"deviceType":"vacoff-blowon","dataType":"output-state-update","LastTS":1633568933199}],"seq":548826,"metricValue":{"key":"client/session_seconds","floatValue":4020.855427104},"metricLabels":[{"key":"operator","value":"4AD9F6"},{"key":"operator_type","value":"robot"},{"key":"client_session","value":"1274f7f5-45ad-4a6a-a2ef-6fb07d80e369"},{"key":"transport","value":"local-tcp"}]}""",
        """{"deviceType":"vacuum-gauge","dataType":"device-status","ts":1633569070175,"experimentToken":"CAMSAA","seq":567282,"status":"failed","error":"out-of-range","message":"Below threshold of 2000"}""",
        """{"deviceType":"blowoff","dataType":"output-state-update","ts":1633569386933,"experimentToken":"CAMSBiUDh_GdEg","seq":610537,"state":[{"intValue":1}]}""",
        """{"deviceType":"label-engine","dataType":"pick-label","ts":1633569206569,"experimentToken":"CAMSAA","seq":585874,"pickLabel":{"label":"SingulateLeftBin","deviceDataRef":[{"ts":1633569205503,"deviceType":"depth-camera"}],"userDataRef":[{"ts":1633569205503,"deviceType":"depth-camera"}],"pose2D":[{"x":391,"y":460}],"position3D":[{"x":-0.312938541173935,"y":-0.72705614566803,"z":-0.19069367647171}],"quaternion3D":[{"w":0.0437927655875683,"x":-0.000906565925106406,"y":0.998826265335083,"z":0.0206771623343229}],"pickID":"0b178327-cbb6-4af6-bebc-5b6ca41f7871","tags":["full-autonomy"],"intent":"pick","successType":"vacuum-pressure-sensor"}}""",
        """{"deviceType":"label-engine","dataType":"place-label","ts":1633569206569,"experimentToken":"CAMSAA","seq":585874,"placeLabel":{"label":"SingulateLeftBin","pose2D":[{"x":391,"y":460}],"position3D":[{"x":-0.312938541173935,"y":-0.72705614566803,"z":-0.19069367647171}],"quaternion3D":[{"w":0.0437927655875683,"x":-0.000906565925106406,"y":0.998826265335083,"z":0.0206771623343229}]}}""",
        """{"deviceType":"vacuum-gauge","dataType":"sensor-state","ts":1633569313493,"experimentToken":"CAMSBiUDh_GdEg","seq":600511,"state":[{"floatValue":1088.253915309906}]}""",
        """{"deviceType":"vacuum-pressure","dataType":"sensor-state-update","ts":1633569265508,"experimentToken":"CAMSBiUDh_GdEg","seq":593943,"state":[{"intValue":1}]}""",
        """{"deviceType":"oracle","deviceName":"pick-points","dataType":"prediction","tag":"2dd30a86-9abc-406e-a7ba-d36b289a89bc","ts":1633568996315,"experimentToken":"CAMSAA","seq":557177,"color":"deduplicated-oracle-pick-points-color-0000882.jpg","pickPoints":[{"x":317,"y":456},{"x":401,"y":410},{"x":476,"y":386},{"x":531,"y":543},{"x":339,"y":495},{"x":359,"y":365},{"x":334,"y":416},{"x":441,"y":478},{"x":560,"y":445},{"x":403,"y":376},{"x":425,"y":355},{"x":529,"y":520},{"x":800,"y":530},{"x":409,"y":527},{"x":481,"y":356},{"x":437,"y":441},{"x":436,"y":386},{"x":370,"y":525},{"x":822,"y":402},{"x":524,"y":448},{"x":734,"y":488},{"x":574,"y":388},{"x":392,"y":449},{"x":498,"y":499}]}""",
        """{"deviceType":"vacuum-pressure","dataType":"key-value","ts":1633569027635,"experimentToken":"CAMSAA","seq":561452,"key":"success","value":"4c06f3d3-f357-4867-b19b-8fe4b4f51f38"}""",
        """{"deviceType":"ping","dataType":"cmd-status","tag":"c94526ae-a70a-49a4-969a-2e635ee7203c","ts":1633569069378,"experimentToken":"CAMSAA","seq":567159,"status":"done"}""",
        """{"deviceType":"ping","dataType":"status","tag":"c94526ae-a70a-49a4-969a-2e635ee7203c","ts":1633569069378,"experimentToken":"CAMSAA","seq":567159,"status":"done"}""",
        """{"deviceType":"robot","dataType":"reach-script-status","tag":"c94526ae-a70a-49a4-969a-2e635ee7203c","ts":1633569069378,"experimentToken":"CAMSAA","seq":567159,"status":"done"}""",
        """{"deviceType":"server","dataType":"hangup","tag":"c94526ae-a70a-49a4-969a-2e635ee7203c","ts":1633569069378,"experimentToken":"CAMSAA","seq":567159}""",
        """{"deviceType":"session-info","dataType":"session-info","ts":1632942429113,"seq":6334,"operatorUID":"test-fake-robot","operatorType":"robot","sessionID":"e57f18e2-f933-480e-b967-88f75de5af03","startTime":1632942423135,"robotName":"test-fake-robot","clientSessionUID":"b70dfd91-fcbc-4b92-86bb-cd2242e13d11"}""",
        """{"deviceType":"session-manager","dataType":"connected-clients","ts":1632944906911,"seq":237,"connectedClients":{"clients":[{"uid":"1a61d106-7f06-4139-8815-5b4538f47069","controlSessionActive":true}]}}""",
        """{"deviceType":"robot","dataType":"controller-descriptions","tag":"8851a64d-edae-4f91-9314-d8e3bc365334","ts":1632944906927,"seq":250,"controllerDescriptions":{"descriptions":[{"name":"test"}]}}""",
        """{"deviceType":"server","dataType":"start-shutdown","ts":1632943090274,"seq":929}""",
        """{"deviceType":"server","dataType":"finish-shutdown","ts":1632943090274,"seq":929}""",
        """{"deviceType":"photoneo","dataType":"report-error","ts":1234,"reportError":{"error":"Test test error - ","tags":["configuration"]}}""",
        """{"deviceType":"photoneo","dataType":"error","ts":1234,"error":"test"}""",
        """{"deviceType":"oracle","deviceName":"pick-points","dataType":"downlink-status","ts":1633379434316,"localTS":1633379434359,"remoteTS":1633379434317,"seq":5819209,"status":"connected","message":"Link still up: oracle-pick-points (PID: 1955) 0"}""",
        """{"deviceType":"instruction-generator","dataType":"text-instruction","ts":1632424595259,"localTS":1632424595306,"remoteTS":1632424595261,"seq":1147570,"textInstruction":{"intent":"dekitting","successType":"deodorant_empty_kit","instruction":"Empty the kit of deodorants","uid":"c255cfb2-b02d-4cae-803c-71417d78264f","supertaskID":"be97ce3a-d7a8-4ed0-b2a5-8018101358ef"}}""",
        """{"deviceType":"discovery","dataType":"machine-description","ts":1633635676720,"machineDescription":{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-state"},{"type":"publish","deviceType":"robot","dataType":"key-value","keys":["robot_constraints.json"]},{"type":"reach-script","deviceType":"robot"}]}}""",
        """{"deviceType":"discovery-aggregator","dataType":"machine-interfaces","ts":1632959589527,"seq":91,"machineInterfaces":{"interfaces":[{"type":"publish","deviceType":"LogDevicetcp-downlink","deviceName":"LogNametcp-downlink","dataType":"downlink-status"},{"type":"client-annotation","deviceType":"client-annotation","dataType":"client-annotation"},{"type":"publish","deviceType":"client-annotation","dataType":"client-annotation"},{"type":"machine-interfaces-request","deviceType":"discovery-aggregator","dataType":"machine-interfaces"},{"type":"pipeline-description-request","deviceType":"discovery-aggregator","dataType":"pipeline-description"},{"type":"disable-experiments","deviceType":"experiment-engine","dataType":"disable-experiments"},{"type":"enable-experiments","deviceType":"experiment-engine","dataType":"enable-experiments"},{"type":"text-instruction-request","deviceType":"instruction-generator","dataType":"text-instruction"},{"type":"publish","deviceType":"label-engine","dataType":"pick-label"},{"type":"publish","deviceType":"label-engine","dataType":"user-label"},{"type":"publish","deviceType":"metrics","deviceName":"quality","dataType":"device-status"},{"type":"user-label","deviceType":"oracle","deviceName":"pick-points","dataType":"user-label"},{"type":"ping","deviceType":"ping","dataType":"ping"},{"type":"publish","deviceType":"reach-script-controller","deviceName":"test","dataType":"downlink-status"},{"type":"reach-script","deviceType":"robot"},{"type":"controller-descriptions-request","deviceType":"robot","dataType":"controller-descriptions"},{"type":"publish","deviceType":"robot","dataType":"emergency-stop-state"},{"type":"publish","deviceType":"robot","dataType":"emergency-stop-state-update"},{"type":"history-request","deviceType":"robot","dataType":"history","keys":["robot_constraints.json"]},{"type":"key-value-request","deviceType":"robot","dataType":"key-value","keys":["robot_constraints.json"]},{"type":"publish","deviceType":"robot","dataType":"protective-stop-state"},{"type":"publish","deviceType":"robot","dataType":"protective-stop-state-update"},{"type":"publish","deviceType":"robot","dataType":"robot-power-state"},{"type":"publish","deviceType":"robot","dataType":"robot-power-state-update"},{"type":"frame-request","deviceType":"robot","dataType":"robot-state"},{"type":"stream-request","deviceType":"robot","dataType":"robot-state"},{"type":"publish","deviceType":"robot","dataType":"safeguard-stop-state"},{"type":"publish","deviceType":"robot","dataType":"safeguard-stop-state-update"},{"type":"publish","deviceType":"server","dataType":"health"},{"type":"publish","deviceType":"server","dataType":"metric"},{"type":"publish","deviceType":"server","deviceName":"manual-intervention-detector","dataType":"metric"},{"type":"connected-clients-request","deviceType":"session-manager","dataType":"connected-clients"},{"type":"history-request","deviceType":"settings-engine","dataType":"history","keys":["actionsets.json","calibration.json","workcell_constraints.json","workcell_io.json","workcell_setup.json"]},{"type":"key-value","deviceType":"settings-engine","dataType":"key-value","keys":["actionsets.json","calibration.json","workcell_constraints.json","workcell_io.json","workcell_setup.json"]},{"type":"key-value-request","deviceType":"settings-engine","dataType":"key-value","keys":["actionsets.json","assembly.json","build-info","calibration.json","display-name","document-config/client","document-config/ikhints","document-config/layouts","document-config/workcell","document-config/workcell_io","robot-name","tasks/TC-101","tasks/TC-104","tasks/TC-106","tasks/TC-107","tasks/TC-109","tasks/TC-110","tasks/TC-112","tasks/TC-113","tasks/TC-114","tasks/TC-115","tasks/TC-116","tasks/TC-117","tasks/TC-118","tasks/TC-119","tasks/TC-120","tasks/TC-121","tasks/TC-122","tasks/TC-123","tasks/TC-124","tasks/TC-126","tasks/TC-127","tasks/TC-128","tasks/TC-129","tasks/TC-130","tasks/TC-131","tasks/TC-132","tasks/TC-133","tasks/TC-135","tasks/TC-136","tasks/TC-137","tasks/TC-138","tasks/TC-140","tasks/TC-141","tasks/TC-142","tasks/TC-143","tasks/TC-144","tasks/TC-145","tasks/TC-146","tasks/TC-147","tasks/TC-148","tasks/TC-149","tasks/TC-150","tasks/TC-151","tasks/TC-152","tasks/TC-3","tasks/TC-301","tasks/TC-302","tasks/TC-303","tasks/TC-304","tasks/TC-305","tasks/TC-306","tasks/TC-307","tasks/TC-308","tasks/TC-309","tasks/TC-310","tasks/TC-311","tasks/TC-312","tasks/TC-313","tasks/TC-314","tasks/TC-315","tasks/TC-451","tasks/TC-93","tasks/TC-94","tasks/TC-999","tasks/TC-999999999","tasks/TC-9999999999","version.json","workcell-tasks","workcell_constraints.json","workcell_io.json","workcell_setup.json"]},{"type":"key-value","deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value"},{"type":"publish","deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value"},{"type":"publish","deviceType":"vacuum-pressure","dataType":"device-status"},{"type":"publish","deviceType":"vacuum-pressure","dataType":"key-value","keys":["failure","success"]}]}}""",
        """{"deviceType":"object-detector","dataType":"health-check","ts":1633368526877,"localTS":1633368526936,"remoteTS":1633368526878,"seq":176777}""",
        """{"deviceType":"settings-engine","dataType":"history","tag":"8bf86011-c212-4d29-a259-e3cfd3e9e85e","ts":1632944906887,"seq":18,"history":{"key":"calibration.json","values":["1","2"],"historyStart":10,"historyEnd":20}}""",
        """{"deviceType":"server","dataType":"health","ts":1631233235041,"seq":188364,"health":{"intervalLengthMs":300039,"displayName":"test-fake-robot","heartBeats":{"anyCamera":{"ok":true},"depthCamera":{"ok":true},"colorCamera":{"ok":true},"notEstopped":{"ok":true},"notPstopped":{"ok":true},"notSafeguardstopped":{"ok":true},"joints":{"ok":true},"clientConnected":{}}}}""",
        """{"deviceType":"discovery-aggregator","dataType":"pipeline-description","ts":1632959589527,"seq":90,"pipelineDescription":{"descriptions":[{},{},{},{},{},{},{"interfaces":[{"type":"client-annotation","deviceType":"client-annotation","dataType":"client-annotation"},{"type":"publish","deviceType":"client-annotation","dataType":"client-annotation"}]},{"interfaces":[{"type":"user-label","deviceType":"oracle","deviceName":"pick-points","dataType":"user-label"},{"type":"publish","deviceType":"label-engine","dataType":"user-label"}]},{"interfaces":[{"type":"key-value","deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value"},{"type":"publish","deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value"}]},{},{"interfaces":[{"type":"reach-script","deviceType":"robot"},{"type":"publish","deviceType":"robot","dataType":"robot-state"},{"type":"publish","deviceType":"robot","dataType":"key-value","keys":["robot_constraints.json"]},{"type":"publish","deviceType":"LogDevicetcp-downlink","deviceName":"LogNametcp-downlink","dataType":"downlink-status"}]},{"interfaces":[{"type":"key-value-request","deviceType":"robot","dataType":"key-value","keys":["robot_constraints.json"]},{"type":"history-request","deviceType":"robot","dataType":"history","keys":["robot_constraints.json"]},{"type":"publish","deviceType":"robot","dataType":"key-value","keys":["robot_constraints.json"],"stopPropagation":true}]},{"interfaces":[{"type":"key-value-request","deviceType":"settings-engine","dataType":"key-value","keys":["tasks/TC-104","tasks/TC-149","tasks/TC-131","tasks/TC-128","tasks/TC-110","tasks/TC-112","tasks/TC-133","tasks/TC-118","tasks/TC-152","tasks/TC-3","assembly.json","tasks/TC-121","tasks/TC-130","tasks/TC-143","tasks/TC-307","tasks/TC-301","workcell_constraints.json","robot-name","tasks/TC-142","tasks/TC-146","tasks/TC-310","tasks/TC-122","tasks/TC-147","workcell_io.json","tasks/TC-151","workcell_setup.json","tasks/TC-107","tasks/TC-119","tasks/TC-303","tasks/TC-129","tasks/TC-113","tasks/TC-148","calibration.json","tasks/TC-117","tasks/TC-140","tasks/TC-308","document-config/workcell","tasks/TC-126","tasks/TC-315","document-config/ikhints","build-info","tasks/TC-114","tasks/TC-101","tasks/TC-116","tasks/TC-302","document-config/client","version.json","tasks/TC-309","tasks/TC-145","tasks/TC-9999999999","tasks/TC-144","display-name","tasks/TC-451","tasks/TC-999","tasks/TC-999999999","tasks/TC-127","tasks/TC-132","tasks/TC-312","tasks/TC-305","tasks/TC-311","document-config/layouts","tasks/TC-138","tasks/TC-137","tasks/TC-109","tasks/TC-124","tasks/TC-135","tasks/TC-106","tasks/TC-314","tasks/TC-93","tasks/TC-150","actionsets.json","workcell-tasks","tasks/TC-120","tasks/TC-123","tasks/TC-141","tasks/TC-136","tasks/TC-115","tasks/TC-313","tasks/TC-306","tasks/TC-304","tasks/TC-94","document-config/workcell_io"]},{"type":"history-request","deviceType":"settings-engine","dataType":"history","keys":["actionsets.json"]},{"type":"key-value","deviceType":"settings-engine","dataType":"key-value","keys":["actionsets.json"]},{"type":"history-request","deviceType":"settings-engine","dataType":"history","keys":["workcell_constraints.json"]},{"type":"key-value","deviceType":"settings-engine","dataType":"key-value","keys":["workcell_constraints.json"]},{"type":"history-request","deviceType":"settings-engine","dataType":"history","keys":["workcell_setup.json"]},{"type":"key-value","deviceType":"settings-engine","dataType":"key-value","keys":["workcell_setup.json"]},{"type":"history-request","deviceType":"settings-engine","dataType":"history","keys":["workcell_io.json"]},{"type":"key-value","deviceType":"settings-engine","dataType":"key-value","keys":["workcell_io.json"]},{"type":"history-request","deviceType":"settings-engine","dataType":"history","keys":["calibration.json"]},{"type":"key-value","deviceType":"settings-engine","dataType":"key-value","keys":["calibration.json"]}]},{"interfaces":[{"type":"key-value-request","deviceType":"settings-engine","dataType":"key-value","keys":["calibration.json"],"replaces":true}]},{"interfaces":[{"type":"key-value","deviceType":"robot-sync-node","dataType":"key-value","keys":["kill"]}]},{},{"interfaces":[{"type":"reach-script","deviceType":"image-tagger"},{"type":"key-value","deviceType":"image-tagger","dataType":"key-value","keys":["kill"]}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"protective-stop-state"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"protective-stop-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"protective-stop-state-update"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"safeguard-stop-state"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"safeguard-stop-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"safeguard-stop-state-update"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"emergency-stop-state"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"emergency-stop-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"emergency-stop-state-update"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"robot-power-state"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-power-state","replaces":true},{"type":"publish","deviceType":"robot","dataType":"robot-power-state-update"}]},{"interfaces":[{"type":"publish","deviceType":"server","deviceName":"manual-intervention-detector","dataType":"metric"}]},{"interfaces":[{"type":"reach-script","deviceType":"reach-script-wait"},{"type":"key-value","deviceType":"reach-script-wait","dataType":"key-value","keys":["kill"]}]},{"interfaces":[{"type":"reach-script","deviceType":"reach-script-translator"},{"type":"reach-script","deviceType":"reach-script-wait","stopPropagation":true},{"type":"reach-script","deviceType":"robot","stopPropagation":true}]},{"interfaces":[{"type":"reach-script","deviceType":"reach-script-controller"},{"type":"controller-descriptions-request","deviceType":"robot","dataType":"controller-descriptions"},{"type":"publish","deviceType":"reach-script-controller","deviceName":"test","dataType":"downlink-status"}]},{"interfaces":[{"type":"reach-script","deviceType":"reach-script-atomizer"},{"type":"reach-script","deviceType":"reach-script-translator","stopPropagation":true},{"type":"reach-script","deviceType":"reach-script-controller","stopPropagation":true}]},{"interfaces":[{"type":"reach-script","deviceType":"robot"},{"type":"reach-script","deviceType":"reach-script-atomizer","stopPropagation":true},{"type":"key-value","deviceType":"reach-script-wait","dataType":"key-value","keys":["kill"],"stopPropagation":true}]},{"interfaces":[{"type":"publish","deviceType":"vacuum-pressure","dataType":"key-value","keys":["success","failure"]}]},{"interfaces":[{"type":"publish","deviceType":"instruction-generator","dataType":"text-instruction"}]},{"interfaces":[{"type":"text-instruction-request","deviceType":"instruction-generator","dataType":"text-instruction"},{"type":"publish","deviceType":"instruction-generator","dataType":"text-instruction","stopPropagation":true}]},{"interfaces":[{"type":"publish","deviceType":"server","dataType":"metric"}]},{"interfaces":[{"type":"publish","deviceType":"server","dataType":"metric","replaces":true}]},{"interfaces":[{"type":"publish","deviceType":"label-engine","dataType":"pick-label"}]},{"interfaces":[{"type":"publish","deviceType":"vacuum-pressure","dataType":"device-status"},{"type":"publish","deviceType":"metrics","deviceName":"quality","dataType":"device-status"}]},{"interfaces":[{"type":"ping","deviceType":"ping","dataType":"ping"}]},{},{"interfaces":[{"type":"reach-script","deviceType":"image-tagger","stopPropagation":true}]},{"interfaces":[{"type":"key-value","deviceType":"image-tagger","dataType":"key-value","keys":["kill"],"stopPropagation":true}]},{},{"interfaces":[{"type":"key-value","deviceType":"robot-sync-node","dataType":"key-value","keys":["kill"],"stopPropagation":true}]},{"interfaces":[{"type":"machine-interfaces-request","deviceType":"discovery-aggregator","dataType":"machine-interfaces"},{"type":"pipeline-description-request","deviceType":"discovery-aggregator","dataType":"pipeline-description"}]},{"interfaces":[{"type":"publish","deviceType":"robot","dataType":"robot-state","stopPropagation":true},{"type":"frame-request","deviceType":"robot","dataType":"robot-state"},{"type":"stream-request","deviceType":"robot","dataType":"robot-state"}]},{"interfaces":[{"type":"client-annotation","deviceType":"client-annotation","dataType":"client-annotation","replaces":true}]},{"interfaces":[{"type":"connected-clients-request","deviceType":"session-manager","dataType":"connected-clients"}]},{"interfaces":[{"type":"publish","deviceType":"server","dataType":"health"}]},{"interfaces":[{"type":"client-annotation","deviceType":"client-annotation","dataType":"client-annotation","replaces":true}]},{"interfaces":[{"type":"enable-experiments","deviceType":"experiment-engine","dataType":"enable-experiments"},{"type":"disable-experiments","deviceType":"experiment-engine","dataType":"disable-experiments"}]}]}}""",
        """{"deviceType":"color-camera","dataType":"webrtc-audio-response","ts":1632347816436,"webrtcAudioResponse":{"success":true}}""",
        """{"deviceType":"color-camera","dataType":"webrtc-audio-request","ts":1632347816436,"webrtcAudioRequest":{"speakerUnmute":true,"microphoneUnmute":true}}""",
        """{"deviceType":"color-camera","dataType":"audio-request-mute","ts":1632347816436,"audioRequestMute":{"textCue":"test"}}""",
        """{"deviceType":"color-camera","dataType":"audio-request-unmute","ts":1632347816436,"audioRequestUnmute":{"textCue":"test"}}""",
        """{"deviceType":"logger","deviceName":"device-data-logger","dataType":"metadata","ts":1633638406496,"messageLastTimestamps":[{"deviceType":"server","deviceName":"manual-intervention-detector","dataType":"metric","LastTS":1633629454497},{"deviceType":"server","dataType":"metric","LastTS":1633638384497},{"deviceType":"server","dataType":"health","LastTS":1633638338345},{"deviceType":"depth-camera","dataType":"color-depth","LastTS":1633638405106},{"deviceType":"operator","deviceName":"5aFP1vzLsfNn5oZhCyxh70k5bau1","dataType":"session-info","LastTS":1633616523243},{"deviceType":"operator","deviceName":"5aFP1vzLsfNn5oZhCyxh70k5bau1","dataType":"cmd-status","LastTS":1633616523243},{"deviceType":"operator","deviceName":"DKIrCHGIKjRodZJiiMxGgviTgQh2","dataType":"cmd-status","LastTS":1633617926924},{"deviceType":"operator","deviceName":"DKIrCHGIKjRodZJiiMxGgviTgQh2","dataType":"session-info","LastTS":1633617926924},{"deviceType":"operator","dataType":"output-state-update","LastTS":1633638236678},{"deviceType":"operator","deviceName":"YOZIPNp5zccGbzQnNpAVZYq2D0g2","dataType":"cmd-status","LastTS":1633620742856},{"deviceType":"operator","deviceName":"YOZIPNp5zccGbzQnNpAVZYq2D0g2","dataType":"session-info","LastTS":1633620742856},{"deviceType":"operator","deviceName":"aph3cX26XdUPrrBOteNr9vwY2zz1","dataType":"session-info","LastTS":1633632302231},{"deviceType":"operator","deviceName":"aph3cX26XdUPrrBOteNr9vwY2zz1","dataType":"cmd-status","LastTS":1633632302231},{"deviceType":"operator","deviceName":"kEWrJ28vinbJM46zR6GUmXVHEvh2","dataType":"cmd-status","LastTS":1633637662005},{"deviceType":"operator","deviceName":"kEWrJ28vinbJM46zR6GUmXVHEvh2","dataType":"session-info","LastTS":1633637662004},{"deviceType":"session-info","dataType":"session-info","LastTS":1633637246649},{"deviceType":"LogSafetyAnalyzerDevice","deviceName":"LogSafetyAnalyzerName","dataType":"downlink-status","LastTS":1633638398345},{"deviceType":"vacuum","dataType":"output-state","LastTS":1633638406417},{"deviceType":"vacuum","dataType":"output-state-update","LastTS":1633638378398},{"deviceType":"blowoff","dataType":"output-state","LastTS":1633638406417},{"deviceType":"blowoff","dataType":"output-state-update","LastTS":1633590635749},{"deviceType":"color-camera","deviceName":"realsense","dataType":"color","LastTS":1633638406421},{"deviceType":"color-camera","dataType":"color","LastTS":1633638406481},{"deviceType":"vnc","deviceName":"vnc0","dataType":"color","LastTS":1633638406453},{"deviceType":"ur-dashboard","dataType":"device-status","LastTS":1633593549353},{"deviceType":"ping","dataType":"cmd-status","LastTS":1633638405593},{"deviceType":"point-reached","deviceName":"place-point","dataType":"output-state-update","LastTS":1633638380803},{"deviceType":"oracle","deviceName":"pick-points","dataType":"device-status","LastTS":1633638397150},{"deviceType":"oracle","deviceName":"pick-points","dataType":"prediction","LastTS":1633629784829},{"deviceType":"oracle","deviceName":"pick-points","dataType":"downlink-status","LastTS":1633638398353},{"deviceType":"oracle","deviceName":"pick-place-success","dataType":"device-status","LastTS":1633638397169},{"deviceType":"oracle","deviceName":"pick-place-success","dataType":"prediction","key":"label","LastTS":1633638384496},{"deviceType":"oracle","deviceName":"pick-place-success","dataType":"downlink-status","LastTS":1633638398345},{"deviceType":"photoneo","dataType":"downlink-status","LastTS":1633638398345},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/layouts","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-136","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-310","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-451","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell_io.json","LastTS":1633637658741},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/workcell","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-145","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-150","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-304","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/client","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-135","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-301","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-106","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-117","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-132","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-107","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-130","LastTS":1633637885527},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-142","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-116","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-138","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-151","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-313","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell_constraints.json","LastTS":1633637658803},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-118","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-121","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-133","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-140","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-146","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-309","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-314","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"actionsets.json","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"calibration.json","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-114","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-126","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-143","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-303","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-311","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"display-name","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-104","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-148","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-149","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-305","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-315","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"version.json","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-312","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"build-info","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/workcell_io","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"robot-name","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-112","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-144","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-3","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-306","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-113","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-119","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-127","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-94","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-129","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-152","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-307","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell_setup.json","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-101","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-115","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-123","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-9999999999","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"workcell-tasks","LastTS":1633637660684},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-128","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-131","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-147","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-93","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"document-config/ikhints","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-109","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-110","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-122","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-124","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-141","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-308","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"assembly.json","LastTS":1633637658875},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-120","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-137","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"key-value","key":"tasks/TC-302","LastTS":1633590636046},{"deviceType":"settings-engine","dataType":"history","key":"actionsets.json","LastTS":1633637658875},{"deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value","key":"bandwidth_out","LastTS":1633638379652},{"deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value","key":"bandwidth_in","LastTS":1633638379653},{"deviceType":"settings-engine","deviceName":"metrics-reporter","dataType":"key-value","key":"depth-camera-latency","LastTS":1633638383157},{"deviceType":"calibration-score","dataType":"key-value","key":"score","LastTS":1633629461538},{"deviceType":"vacoff-blowon","dataType":"output-state","LastTS":1633638406417},{"deviceType":"vacoff-blowon","dataType":"output-state-update","LastTS":1633638378398},{"deviceType":"safety-analyzer","dataType":"device-status","LastTS":1633638401298},{"deviceType":"session-manager","dataType":"connected-clients","LastTS":1633637662005},{"deviceType":"vacuum-gauge","dataType":"sensor-state","LastTS":1633638406417},{"deviceType":"vacuum-gauge","dataType":"device-status","LastTS":1633590636236},{"deviceType":"discovery-aggregator","dataType":"pipeline-description","LastTS":1633619433917},{"deviceType":"discovery-aggregator","dataType":"machine-interfaces","LastTS":1633619433917},{"deviceType":"label-engine","dataType":"pick-label","LastTS":1633638368974},{"deviceType":"instruction-generator","dataType":"text-instruction","LastTS":1633638238000},{"deviceType":"object-detector","dataType":"downlink-status","LastTS":1633638398346},{"deviceType":"object-detector","dataType":"health-check","LastTS":1633638400080},{"deviceType":"robot","dataType":"protective-stop-state","LastTS":1633638406417},{"deviceType":"robot","dataType":"robot-power-state","LastTS":1633638406417},{"deviceType":"robot","dataType":"robot-power-state-update","LastTS":1633590636336},{"deviceType":"robot","dataType":"emergency-stop-state","LastTS":1633638406417},{"deviceType":"robot","dataType":"safeguard-stop-state-update","LastTS":1633622580342},{"deviceType":"robot","dataType":"protective-stop-state-update","LastTS":1633590635749},{"deviceType":"robot","dataType":"key-value","key":"robot_constraints.json","LastTS":1633590671600},{"deviceType":"robot","dataType":"cmd-status","LastTS":1633638381944},{"deviceType":"robot","dataType":"robot-state","LastTS":1633638406417},{"deviceType":"robot","dataType":"emergency-stop-state-update","LastTS":1633590635749},{"deviceType":"robot","dataType":"safeguard-stop-state","LastTS":1633638406417},{"deviceType":"vacuum-pressure","dataType":"sensor-state","LastTS":1633638406417},{"deviceType":"vacuum-pressure","dataType":"sensor-state-update","LastTS":1633638378499},{"deviceType":"vacuum-pressure","dataType":"key-value","key":"failure","LastTS":1633637908548},{"deviceType":"vacuum-pressure","dataType":"key-value","key":"success","LastTS":1633638378399}],"seq":7571061,"metadata":{"endFile":true}}""",
        """{"deviceType":"robot","dataType":"protective-stop-state-update","ts":1234,"isProtectiveStopped":true}""",
        """{"deviceType":"robot","dataType":"emergency-stop-state-update","ts":1234,"isEmergencyStopped":true}""",
        """{"deviceType":"robot","dataType":"safeguard-stop-state-update","ts":1234,"isSafeguardStopped":true}""",
        """{"deviceType":"robot","dataType":"robot-power-state-update","ts":1234,"robotPowerStateUpdate":{"isRobotPowerOn":true}}""",
        """{"deviceType":"client-annotation","dataType":"client-annotation","ts":1624655682162,"seq":8152,"clientAnnotation":{"snapshotAnnotation":{}}}""",
        """{"deviceType":"test","dataType":"sim-instance-segmentation","ts":1234,"simInstanceSegmentation":{"simTS":12,"imagePath":"test.jpg","relation":[{"key":"test-key","value":"test-value"}]}}""",
        """{"deviceType":"test","dataType":"sim-state","ts":1234,"simState":{"simTS":12,"objectState":[{"id":"test","objectName":"obj","poseXYZXYZW":[1,2,3,4,5,6,7],"linearVel":[8,9,10]}]}}""",
        """{"deviceType":"conveyor","dataType":"conveyor-state","ts":1234,"isObjectDetected":true}""",
        """{"deviceType":"conveyor","dataType":"conveyor-state-update","ts":1234,"isObjectDetected":true}""",
        """{"deviceType":"test-level","dataType":"level","ts":1234,"level":2.2}""",
        """{"deviceType":"camera","dataType":"exposure-complete","ts":1234}""",
        """{"deviceType":"vacuum","dataType":"vacuum-pressure-state","ts":1234,"vacuumLevelPa":1.1,"on":true}""",
        """{"deviceType":"vacuum","dataType":"vacuum-pressure-update","ts":1234,"vacuumLevelPa":1.1,"on":true}""",
        """{"deviceType":"vacuum","dataType":"tool-state","ts":1234,"vacuumLevelPa":1.1,"on":true}""",
        """{"deviceType":"vacuum","dataType":"tool-state-update","ts":1234,"vacuumLevelPa":1.1,"on":true}""",
        """{"deviceType":"object-detector","dataType":"detection","ts":328913823,"detection":{"source":{"ts":1234,"deviceType":"color-camera","deviceName":"realsense","dataType":"color"},"detections":[{"id":"224","type":"Apriltag","corners":[138.22935485839832,138.4850769042971,147.43933105468767,150.43307495117193,131.59306335449227,155.51124572753886,122.27986145019513,143.28016662597648]},{"id":"228","type":"Apriltag","corners":[137.1153564453125,178.20991516113284,124.51042938232422,168.261962890625,137.82957458496094,156.27760314941406,149.39590454101562,165.89585876464844]},{"id":"239","type":"Apriltag","corners":[128.08790588378903,245.9555206298828,126.82250213623048,227.06994628906247,145.2277221679688,227.02252197265628,146.34443664550778,245.9164581298828]},{"id":"243","type":"Apriltag","corners":[167.9124908447265,238.39472961425778,151.24836730957026,236.58897399902355,151.11486816406256,218.03308105468756,167.91677856445318,220.40748596191398]},{"id":"244","type":"Apriltag","corners":[155.2664794921876,213.1181640625,140.16363525390628,223.41111755371077,127.59188079833973,218.46644592285162,142.71180725097653,208.70361328125026]},{"id":"test_data/integration_tests/3B76A1/d1796-224-001.json","type":"AprilGroup","extrinsics":[-0.9390630574721055,-0.44594610139097784,1.4915441230763948,0.7744853267176356,2.2851093412092935,-0.27036286187714104],"aprilGroup":{"aprilTags":[{"id":"224","corners":[137.65422972735962,138.5649359084431,147.19558765156103,151.34910294028998,131.32066537919889,155.61908616545156,121.67631495189369,142.72016518681818]},{"id":"225","corners":[149.2311243879377,143.91466466853797,132.02603713664166,135.7925018898256,130.81062019671106,138.25361433549455,147.85988098802397,146.2829356794325]},{"id":"229","corners":[151.64231969161347,145.22704467881834,157.13748627856785,160.0162109529967,153.33267016725392,167.25080257441044,147.75802891473427,152.38745209695196]},{"id":"230","corners":[138.85193027924515,178.81752019190571,152.80960037825605,170.0925733535371,154.39030576625305,167.59459000990694,140.57000589900917,176.23102580963098]},{"id":"231","corners":[139.51614320402575,161.74109054474337,151.53914219869716,169.57962509623263,155.88482785401072,155.26274219432474,143.80580940280709,147.4130644603773]},{"id":"232","corners":[139.6957901718855,148.36928162250604,127.10341951803844,137.87764050845482,114.49211158720823,148.1240760592396,127.23992869091012,158.53216024352633]},{"id":"235","corners":[116.98961922940259,165.57915420234656,127.74422634271025,177.85597740139883,142.57629297305255,172.48043655733568,131.93746160290232,160.30643329904802]},{"id":"226","corners":[127.72376568730647,135.60192303989822,123.3738109852402,139.45031082025054,109.75056595836236,147.65086218323694,114.2360645100415,143.72414066121587]},{"id":"227","corners":[108.64810545823116,160.72889938596614,112.37637367040361,145.68965436447718,124.95882376921872,153.11597352735458,121.168061119105,168.14656441541115]},{"id":"228","corners":[137.57537929171542,177.41775232889103,124.90499939890572,166.9378756939871,137.78428950280454,156.59785496448058,150.2982173068899,167.16385871037738]},{"id":"233","corners":[112.87151602148788,167.97179940721594,127.98243515750278,173.44013441482014,136.5744780668748,179.67845272592854,121.66178069766045,174.2831274834494]},{"id":"234","corners":[111.2396879483149,146.8607805479457,107.17176008650154,154.3294653998803,113.20082793504139,169.15365053274854,117.18311910821183,161.61671806474084]}]}},{"id":"test_data/integration_tests/3B76A1/d1796-236-002.json","type":"AprilGroup","extrinsics":[-0.8396783524235848,-0.2977786293817617,1.3390485238543468,-0.7652232307299377,-1.636362610959486,-0.8152877882231798],"aprilGroup":{"aprilTags":[{"id":"236","corners":[125.0651853346053,241.54050084680563,140.853053215174,251.86755492785244,148.11575476310804,256.8609710345072,132.54672042793356,246.67418169344586]},{"id":"238","corners":[159.9593265631537,256.2001784070028,143.51800677224048,254.186817377813,153.35348246398348,243.14289465186022,169.75773073512448,245.2970466011201]},{"id":"242","corners":[171.7368891659254,242.43071720428833,171.06026521158844,249.2201214165255,173.36885219551175,232.73469719921917,174.0294234744356,226.07093819768505]},{"id":"243","corners":[169.34807653809878,239.69011205119568,151.2763371191627,236.59890282051686,150.38304478115117,218.6340649634384,168.45999872935056,221.92502940101633]},{"id":"244","corners":[154.3529979197732,213.97886454034585,139.23456212960127,223.18439165540138,126.92043948529715,217.84133587312186,142.07995363068153,208.72131983045688]},{"id":"247","corners":[170.98086313404417,222.59997038907284,172.35536268441592,222.89929102386867,155.1793561190692,211.18605853647665,153.9790636826507,211.01037832951772]},{"id":"237","corners":[144.71748131905838,251.225579923723,155.01547439193246,257.4166585246217,170.81544572644123,248.77563215970758,160.51256588044328,242.6734774513908]},{"id":"239","corners":[129.68958425675373,244.53675772838,126.46050643409592,226.19595543882343,144.55100334139695,226.74030001618257,147.68206356265785,245.0757662828958]},{"id":"245","corners":[156.44552310698043,216.80375015097434,147.50870345127146,230.2350093313088,162.9543390538065,241.99461689743958,171.91569261863776,228.6430846471515]},{"id":"246","corners":[147.038739625473,207.66586794429685,128.2845447705257,213.69284166238276,133.13973522376932,223.36062256768867,151.63888803110694,217.35127312099934]},{"id":"240","corners":[125.64713424011688,227.66667631422956,126.94765484352263,214.5203966930177,125.31304332149853,226.99238993628188,124.02048375183494,240.12447906939462]},{"id":"241","corners":[151.2582890863572,238.50184790380536,138.55445944449843,223.4776336620974,125.71575462753594,232.99965256437434,138.63054558651652,248.09014975860146]}]}}]}}"""
    ]
    for test in tests:
      data_json = json.loads(test)
      data = types_gen.DeviceData.from_json(data_json)
      self.assertEqual(data_json, data.to_json())
      proto = data.to_proto()
      loaded = logs_pb2.DeviceData.FromString(proto.SerializeToString())
      self.assertEqual(proto, loaded)
      loaded_data = types_gen.DeviceData.from_proto(loaded)
      self.assertEqual(data_json, loaded_data.to_json())

  def test_command_data_protoloop(self) -> None:
    tests = [
        """{"deviceType":"robot","dataType":"reach-script","tag":"66af055f-1db4-4cb4-bf94-d428883bec46","ts":1633562395625,"origin":"BggklTTDRjaByWqx2Wgw3g16mup1","originType":"user","originTransportType":"webrtc","originClient":"9da9d88f-c5ce-4a85-860d-501efce276c6","originControl":"0fc75984-5e76-40be-9f32-329956cfdf82","seq":123747,"reachScript":{"commands":[{"movejPath":{"waypoints":[{"rotation":[0.313185453414917,-2.31111145019531,2.06560039520264,-1.49419093132019,-1.71313691139221,-0.369724154472351],"velocity":1.5,"acceleration":1.5},{"rotation":[-0.296245753765106,-1.23183155059814,1.98890054225922,-2.40981245040894,-1.61127018928528,-1.94020545482636],"velocity":1.5,"acceleration":1.5}]}},{"setOutput":{"type":"vacuum","args":[{"intValue":1}]}},{"movelPath":{"waypoints":[{"rotation":[-0.301202595233917,-1.15287482738495,2.01760745048523,-2.51767444610596,-1.61086392402649,-1.94515013694763],"blendRadius":0.009999999776482582,"velocity":0.30000001192092896,"acceleration":5},{"rotation":[-0.320579439401627,-0.8383509516716,2.04226088523865,-2.85761165618896,-1.60926628112793,-1.96447551250458],"velocity":0.30000001192092896,"acceleration":5,"limits":{"force":{"maximum":[1000,1000,0,1000,1000,1000],"minimum":[-1000,-1000,-1000,-1000,-1000,-1000]}}},{"rotation":[-0.287522614002228,-1.34660291671753,1.91277527809143,-2.21856069564819,-1.61198246479034,-1.9315048456192],"velocity":1.5,"acceleration":3},{"rotation":[0.848285019397736,-1.70281684398651,1.7980375289917,-1.64599323272705,-1.69772064685822,0.825146079063416],"velocity":1.5,"acceleration":1.5}]}},{"setOutput":{"type":"read-product-code","args":[{"intValue":1}]}},{"movelPath":{"waypoints":[{"rotation":[0.446933448314667,-1.41747438907623,1.54027235507965,-1.67011439800262,-1.55037951469421,-3.18910527229309],"velocity":1.5,"acceleration":1.5,"limits":{"sensor":[{"deviceType":"successful-product-scan","value":{"intValue":1},"maximum":{},"minimum":{}}]}}]}},{"movejPath":{"waypoints":[{"rotation":[0.446933448314667,-1.41747438907623,1.54027235507965,-1.67011451721191,-1.55037951469421,-1.59671068191528],"velocity":0.30000001192092896,"acceleration":0.20000000298023224,"limits":{"sensor":[{"deviceType":"successful-product-scan","value":{"intValue":1},"maximum":{},"minimum":{}}]}},{"rotation":[0.446933448314667,-1.41747438907623,1.54027235507965,-1.67011439800262,-1.55037951469421,-0.231791451573372],"velocity":0.30000001192092896,"acceleration":0.20000000298023224,"limits":{"sensor":[{"deviceType":"successful-product-scan","value":{"intValue":1},"maximum":{},"minimum":{}}]}},{"rotation":[0.446933418512344,-1.41747438907623,1.54027235507965,-1.67011439800262,-1.55037939548492,1.07472658157349],"velocity":0.30000001192092896,"acceleration":0.20000000298023224,"limits":{"sensor":[{"deviceType":"successful-product-scan","value":{"intValue":1},"maximum":{},"minimum":{}}]}},{"rotation":[0.446933418512344,-1.41747438907623,1.54027235507965,-1.67011439800262,-1.55037939548492,2.39365291595459],"velocity":0.30000001192092896,"acceleration":0.20000000298023224,"limits":{"sensor":[{"deviceType":"successful-product-scan","value":{"intValue":1},"maximum":{},"minimum":{}}]}},{"rotation":[0.446933448314667,-1.41747438907623,1.54027235507965,-1.67011439800262,-1.55037951469421,-0.464028835296631],"velocity":1,"acceleration":1,"limits":{"sensor":[{"deviceType":"successful-product-scan","value":{"intValue":1},"maximum":{},"minimum":{}}]}}]}},{"setOutput":{"type":"read-product-code","args":[{}]}},{"wait":{"timeoutSeconds":0.5,"timeoutAction":{"type":"abort","abortMessage":"Unsuccessful Scan"},"expr":{"op":"eq","arg1":{"varExpr":{"capability":{"type":"successful-product-scan"}}},"arg2":{"constExpr":{"capability":{"type":"successful-product-scan","state":[{"intValue":1}]}}}}}},{"movejPath":{"waypoints":[{"rotation":[0.313185453414917,-2.31111145019531,2.06560039520264,-1.49419093132019,-1.71313691139221,-0.369724154472351],"velocity":1.5,"acceleration":1.5}]}}],"calibrationRequirement":{}},"intent":"pick","exp":{"label":"Inbound-PICK","depthTS":1633562393311,"pose2D":{"x":593,"y":77},"position3D":{"x":-0.787917792797089,"y":0.0897345617413521,"z":-0.265530437231064},"quaternion3D":{"w":-0.0100754583254457,"x":0.0264593362808228,"y":0.999089896678925,"z":0.0319041982293129},"tags":["manual"],"userTS":1633562393311},"expArray":[{"label":"Inbound-PICK","depthTS":1633562393311,"pose2D":{"x":593,"y":77},"position3D":{"x":-0.787917792797089,"y":0.0897345617413521,"z":-0.265530437231064},"quaternion3D":{"w":-0.0100754583254457,"x":0.0264593362808228,"y":0.999089896678925,"z":0.0319041982293129},"tags":["manual"],"userTS":1633562393311}],"experimentToken":"CAMSBiUDh_GdEg"}""",
        """{"deviceType":"robot","dataType":"reach-script","tag":"2ac26700-2857-4ca1-9886-fb5487362e7f","ts":1633562396512,"origin":"BggklTTDRjaByWqx2Wgw3g16mup1","originType":"user","originTransportType":"webrtc","originClient":"9da9d88f-c5ce-4a85-860d-501efce276c6","originControl":"0fc75984-5e76-40be-9f32-329956cfdf82","seq":123773,"reachScript":{"preemptive":true,"commands":[{"stopJ":{"deceleration":15}}],"version":10,"preemptiveReason":"test","calibrationRequirement":{"allowUncalibrated":true}},"experimentToken":"CAMSBiUDh_GdEg"}""",
        """{"deviceType":"robot","dataType":"ur-command","tag":"2ac26700-2857-4ca1-9886-fb5487362e7f","ts":1633562396512,"origin":"BggklTTDRjaByWqx2Wgw3g16mup1","originType":"user","originTransportType":"webrtc","originClient":"9da9d88f-c5ce-4a85-860d-501efce276c6","originControl":"0fc75984-5e76-40be-9f32-329956cfdf82","seq":123773,"reachScript":{"preemptive":true,"commands":[{"stopJ":{"deceleration":15}}],"version":10,"preemptiveReason":"test","calibrationRequirement":{"allowUncalibrated":true}},"experimentToken":"CAMSBiUDh_GdEg"}""",
        """{"deviceType":"robot","dataType":"frame-request","ts":1633564060147,"origin":"E5hGeGfO0ncQtBEQlsYyXkqyPXr1","originType":"user","originTransportType":"webrtc","originClient":"3a64bd81-abd7-4bb2-bef1-074addb66871","originControl":"fed7af82-a92b-41a2-9a85-5cd45107bb3b","seq":150438,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"color-camera","dataType":"frame-request","ts":1633564060185,"origin":"E5hGeGfO0ncQtBEQlsYyXkqyPXr1","originType":"user","originTransportType":"webrtc","originClient":"3a64bd81-abd7-4bb2-bef1-074addb66871","originControl":"fed7af82-a92b-41a2-9a85-5cd45107bb3b","seq":150439,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"color-camera","deviceName":"g3flex_2","dataType":"frame-request","ts":1633564060213,"origin":"E5hGeGfO0ncQtBEQlsYyXkqyPXr1","originType":"user","originTransportType":"webrtc","originClient":"3a64bd81-abd7-4bb2-bef1-074addb66871","originControl":"fed7af82-a92b-41a2-9a85-5cd45107bb3b","seq":150440,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"vnc","deviceName":"vnc0","dataType":"frame-request","ts":1633564060214,"origin":"E5hGeGfO0ncQtBEQlsYyXkqyPXr1","originType":"user","originTransportType":"webrtc","originClient":"3a64bd81-abd7-4bb2-bef1-074addb66871","originControl":"fed7af82-a92b-41a2-9a85-5cd45107bb3b","seq":150441,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"robot","dataType":"frame-request","ts":1633564060251,"origin":"E5hGeGfO0ncQtBEQlsYyXkqyPXr1","originType":"user","originTransportType":"webrtc","originClient":"3a64bd81-abd7-4bb2-bef1-074addb66871","originControl":"fed7af82-a92b-41a2-9a85-5cd45107bb3b","seq":150442,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"logger","deviceName":"command-data-logger","dataType":"metadata","ts":1633564503849,"seq":168847,"metadata":{"beginFile":true,"realTimeLogs":true}}""",
        """{"deviceType":"any","deviceName":"any","dataType":"experiment-flags","ts":1633564518342,"seq":169443,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"ping","dataType":"ping","tag":"08ca01a0-91db-4559-8357-9fa82ecedfd8","ts":1633564518799,"origin":"E5hGeGfO0ncQtBEQlsYyXkqyPXr1","originType":"user","originTransportType":"webrtc","originClient":"3a64bd81-abd7-4bb2-bef1-074addb66871","originControl":"fed7af82-a92b-41a2-9a85-5cd45107bb3b","seq":169464,"experimentToken":"CAMSAA"}""",
        """{"deviceType":"logger","deviceName":"command-data-logger","dataType":"metadata","ts":1630962679527,"seq":2,"metadata":{"beginFile":true}}""",
        """{"deviceType":"any","deviceName":"any","dataType":"experiment-flags","ts":1630962679526,"seq":1}""",
        """{"deviceType":"server","dataType":"start-shutdown","ts":1630962683386,"seq":3}""",
        """{"deviceType":"server","dataType":"finish-shutdown","ts":1630962683394,"seq":4}""",
        """{"deviceType":"session-manager","dataType":"client-session-start","ts":1630966359358,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"b9661cac-f974-45b4-af8d-6b4f9c4ffc74","seq":3,"clientSessionStart":{},"eventParams":[{"key":"operator","value":"test-fake-robot"},{"key":"operator_type","value":"robot"}]}""",
        """{"deviceType":"discovery-aggregator","dataType":"machine-interfaces-request","tag":"1630966359360566527","ts":1630966359361,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"b9661cac-f974-45b4-af8d-6b4f9c4ffc74","seq":4}""",
        """{"deviceType":"session-manager","dataType":"client-session-end","ts":1630966360832,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"b9661cac-f974-45b4-af8d-6b4f9c4ffc74","seq":5,"message":"done"}""",
        """{"deviceType":"discovery-aggregator","dataType":"pipeline-description-request","tag":"1630966529492523468","ts":1630966529492,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"a63100cc-17e8-4b92-8580-0c488cab5baa","seq":4}""",
        """{"deviceType":"settings-engine","dataType":"key-value-request","tag":"a6852830-65ee-4cf1-9d7e-3e999e6ce4e3","ts":1631228448458,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"ce5bf2e5-de03-4e17-b19c-6828d2f0db81","seq":5,"key":"workcell_io.json"}""",
        """{"deviceType":"ping","dataType":"ping","tag":"412b2c59-b0f1-4b55-8468-bead9bf80ae6","ts":1631228448477,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"ce5bf2e5-de03-4e17-b19c-6828d2f0db81","seq":9}""",
        """{"deviceType":"session-manager","dataType":"connected-clients-request","ts":1631228448477,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"ce5bf2e5-de03-4e17-b19c-6828d2f0db81","seq":10}""",
        """{"deviceType":"color-camera","dataType":"frame-request","ts":1631228448487,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"ce5bf2e5-de03-4e17-b19c-6828d2f0db81","seq":19}""",
        """{"deviceType":"operator","deviceName":"test-fake-robot","dataType":"session-info","tag":"4c4f3361-eaf2-4d2b-bc03-9d6bb11096f0","ts":1631235283296,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"d275ebf2-8d46-4f42-91f4-31c673999074","originControl":"1d35796b-7411-4120-950f-b40dd7762370","seq":11,"sessionInfo":{"operatorUID":"test-fake-robot","operatorType":"robot","sessionID":"1d35796b-7411-4120-950f-b40dd7762370","startTime":1631235283295,"robotName":"test-fake-robot","clientSessionUID":"d275ebf2-8d46-4f42-91f4-31c673999074"}}""",
        """{"deviceType":"robot","dataType":"controller-descriptions-request","tag":"11cf33e6-2b1d-46da-a8a3-ace7b361e098","ts":1631235355233,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"83e8ac62-f2be-4f01-86e3-0dbaa1454dd9","originControl":"292a4b03-7936-4332-9087-f172f6fe4e5d","seq":86}""",
        """{"deviceType":"robot","dataType":"reach-script","tag":"17329b23-c624-455e-83c2-7724edc6729f","ts":1631310527306,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"a369a4af-66e3-41ea-a9db-96bd4a359a41","originControl":"65a49da0-571d-463c-a924-08dd2780180f","seq":51,"reachScript":{"commands":[{"movejPath":{"waypoints":[{"rotation":[1.665570735931396,-0.7995384496501465,1.341465298329489,-2.12082638363027,4.660228729248047,0.01271963119506836],"servo":true}]}}]}}""",
        """{"deviceType":"ping","dataType":"ping","tag":"ping-1632347759814","ts":1632347759814}""",
        """{"deviceType":"i-see-data","dataType":"i-see-data","ts":1632347761824}""",
        """{"deviceType":"discovery-aggregator","dataType":"machine-interfaces-request","tag":"3caacdad-e0e5-4746-b098-30becb3108bd","ts":1632347785532}""",
        """{"deviceType":"settings-engine","dataType":"key-value-request","tag":"a5fc8537-401b-4854-a51a-beed5334a338","ts":1632347785532,"key":"workcell_io.json"}""",
        """{"deviceType":"session-manager","dataType":"connected-clients-request","ts":1632347785733}""",
        """{"deviceType":"color-camera","dataType":"frame-request","ts":1632347816436}""",
        """{"deviceType":"color-camera","dataType":"audio-request-mute","ts":1632347816436,"webrtcAudioRequest":{"speakerUnmute":true,"microphoneUnmute":true}}""",
        """{"deviceType":"color-camera","dataType":"audio-request-unmute","ts":1632347816436,"webrtcAudioRequest":{"speakerUnmute":true,"microphoneUnmute":true}}""",
        """{"deviceType":"color-camera","dataType":"webrtc-audio-request","ts":1632347816436,"webrtcAudioRequest":{"speakerUnmute":true,"microphoneUnmute":true}}""",
        """{"deviceType":"color-camera","dataType":"audio-request-invalid","ts":1632347816436,"webrtcAudioRequest":{"speakerUnmute":true,"microphoneUnmute":true}}""",
        """{"deviceType":"color-camera","dataType":"trigger","ts":1632347816436}""",
        """{"deviceType":"text-instruction","dataType":"text-instruction-request","ts":1632347816436}""",
        """{"deviceType":"operator","dataType":"event","ts":1633567526914,"origin":"4AD9F6","originType":"robot","originTransportType":"local-tcp","originClient":"1274f7f5-45ad-4a6a-a2ef-6fb07d80e369","originControl":"4d321b36-0774-4f0b-a158-e45a4d8b14ee","seq":55956,"eventDuration":13.765,"eventName":"pick","eventLabels":["122","2d_camera","2d_window","BIN_CLEAR"],"eventParams":[{"key":"task-code","value":"122"},{"key":"agent_id","value":"full-autonomy"},{"key":"camera-mode","value":"2d_camera"},{"key":"window-mode","value":"2d_window"},{"key":"bin-clear","intValue":1},{"key":"task-success","value":"SUCCESS"},{"key":"task-success-int","intValue":1}],"experimentToken":"CAMSAA"}""",
        """{"deviceType":"robot","dataType":"reach-script","tag":"4bf5d9ff-b9ce-4bb4-88c3-b968656463b7","ts":1633567648971,"origin":"4AD9F6","originType":"robot","originTransportType":"local-tcp","originClient":"1274f7f5-45ad-4a6a-a2ef-6fb07d80e369","originControl":"4d321b36-0774-4f0b-a158-e45a4d8b14ee","seq":58563,"reachScript":{"commands":[{"movejPath":{"waypoints":[{"rotation":[1.60850512981415,-0.68231213092804,1.38381767272949,-2.2211902141571,4.65872526168823,0.0404435247182846],"blendRadius":0.0500000007450581,"velocity":2,"acceleration":8}]}},{"setOutput":{"type":"vacuum","args":[{"intValue":1}]}},{"movelPath":{"waypoints":[{"rotation":[1.59288144111633,-0.469489455223084,1.36545586585999,-2.41649532318115,4.65793371200562,0.024816419929266],"velocity":1,"acceleration":4}]}},{"sleep":{"seconds":0.100000001490116}},{"movelPath":{"waypoints":[{"rotation":[1.61132943630219,-0.715839684009552,1.37616062164307,-2.17985486984253,4.65886974334717,0.0432681851089001],"velocity":1,"acceleration":4}]}},{"movejPath":{"waypoints":[{"rotation":[1.39122605323792,-0.997107028961182,1.65451574325562,-2.23251128196716,4.67453241348267,-0.124608546495438],"blendRadius":0.0199999995529652,"velocity":2,"acceleration":8},{"rotation":[0.956087529659271,-0.684006333351135,1.42621421813965,-2.3967764377594,4.73526287078857,-0.685278534889221],"blendRadius":0.00999999977648258,"velocity":2,"acceleration":8}]}},{"setOutput":{"type":"vacoff-blowon","args":[{"intValue":1}]}},{"sleep":{"seconds":0.100000001490116}},{"movejPath":{"waypoints":[{"rotation":[1.33652377128601,-1.13329195976257,1.94392383098602,-2.40604114532471,4.66566705703735,-0.316687762737274],"velocity":2,"acceleration":8}]}},{"setOutput":{"type":"blowoff","args":[{}]}}],"calibrationRequirement":{}},"intent":"pick","successType":"vacuum-pressure-sensor","exp":{"label":"SingulateRightBin","depthTS":1633567647905,"pose2D":{"x":763,"y":496},"position3D":{"x":0.138026505708694,"y":-0.772982954978943,"z":-0.194120407104492},"quaternion3D":{"w":-0.0277973003685474,"x":0.000680841156281531,"y":0.999313652515411,"z":0.0244763195514679},"tags":["full-autonomy"],"userTS":1633567647905},"expArray":[{"label":"SingulateRightBin","depthTS":1633567647905,"pose2D":{"x":763,"y":496},"position3D":{"x":0.138026505708694,"y":-0.772982954978943,"z":-0.194120407104492},"quaternion3D":{"w":-0.0277973003685474,"x":0.000680841156281531,"y":0.999313652515411,"z":0.0244763195514679},"tags":["full-autonomy"],"userTS":1633567647905}],"experimentToken":"CAMSBiUDh_GdEg"}""",
        """{"deviceType":"color-camera","dataType":"stream-request","ts":1632347816436,"streamRequest":{"deviceType":"color-camera","deviceName":"test","dataType":"color","maxRate":10}}""",
        """{"deviceType":"color-camera","dataType":"hangup","ts":1632347816436}""",
        """{"deviceType":"oracle","deviceName":"pick-place-success","dataType":"inference-request","tag":"b8349e28-6d23-49e7-8da4-a3bf12a6b69a","ts":1632347816439,"robotID":"1746BF"}""",
        """{"deviceType":"settings-engine","dataType":"key-value-request","tag":"8bf86011-c212-4d29-a259-e3cfd3e9e85e","ts":1632944906887,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"1a61d106-7f06-4139-8815-5b4538f47069","seq":18,"key":"calibration.json"}""",
        """{"deviceType":"settings-engine","dataType":"key-value","tag":"8bf86011-c212-4d29-a259-e3cfd3e9e85e","ts":1632944906887,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"1a61d106-7f06-4139-8815-5b4538f47069","seq":18,"key":"calibration.json","value":"test"}""",
        """{"deviceType":"settings-engine","dataType":"history-request","tag":"8bf86011-c212-4d29-a259-e3cfd3e9e85e","ts":1632944906887,"origin":"test-fake-robot","originType":"robot","originTransportType":"local-tcp","originClient":"1a61d106-7f06-4139-8815-5b4538f47069","seq":18,"history":{"key":"calibration.json","historyStart":10,"historyEnd":20}}""",
        """{"deviceType":"client-annotation","dataType":"client-annotation","ts":1624655682162,"origin":"SHHKruNDmkghr97NLwZmoP8QkWg1","originType":"user","originTransportType":"webrtc","originClient":"72a0aa2e-9997-4d88-b42b-464e49ce7d22","originControl":"3a3249ae-bdfb-4608-8704-cb65fd4dbfac","seq":8152,"snapshot":{"source":"pyreach_gym","deviceDataRefs":[{"ts":1624655682007,"seq":9734},{"ts":1624655681240,"seq":9699},{"ts":1624655674253,"seq":9365}],"gymEnvId":"??","gymRunId":"8bc7183e-ea03-4229-96ae-17bb45d0b803","gymEpisode":1,"gymStep":3783},"clientAnnotation":{"snapshotAnnotation":{}},"experimentToken":"CAMSBiUDh_GdEg"}""",
        """{"deviceType":"client-annotation","dataType":"client-annotation","ts":1629488164484,"snapshot":{"source":"pyreach_gym","deviceDataRefs":[{"ts":1629488164010,"seq":52395},{"ts":1629488163967,"seq":52389},{"ts":1629488163926,"seq":52380},{"ts":1629488163957,"seq":52388},{"ts":1629488163948,"seq":52382},{"ts":1629488161905,"seq":51833},{"ts":1629488164042,"seq":52411}],"responses":[{"deviceDataRef":{"ts":1629488163390,"seq":52229},"gymElementType":"arm","gymConfigName":"arm"},{"deviceDataRef":{},"gymElementType":"arm-0","gymConfigName":"arm"},{"deviceDataRef":{"ts":1629488163542,"seq":52272},"cid":1,"gymElementType":"text-instruction","gymConfigName":"text_instructions"}],"gymServerTS":1629488164441,"gymEnvId":"benchmark-folding-v2","gymRunId":"d7f41e9e-e1e5-4de8-a6e2-2e99d5f20ccd","gymEpisode":1,"gymStep":4}}""",
        """{"deviceType":"vnc","deviceName":"vnc0","dataType":"pointer-event","tag":"fe040b25-ff86-443d-a299-633d17ee8cf8","ts":1632960016122,"cmd":"send-click","x":0.14583333333333334,"y":0.04166666666666666}""",
        """{"deviceType":"operator","dataType":"event-start","ts":1632424405953,"eventParams":[{"key":"agent_id","value":"kitting-example-v0"},{"key":"intent","value":"pick"},{"key":"reset_id","value":"a8a1a65a-cd2e-481d-9fbb-14f78cbb7aa1"},{"key":"success_type","value":"vacuum-pressure-sensor"},{"key":"task-code","value":"130"}]}""",
        """{"deviceType":"script-engine","dataType":"run-script","tag":"28639b16-af86-4531-b8b5-2045dfd4a32a","ts":1632426930526,"script":"sim reset"}""",
        """{"deviceType":"experiment","dataType":"enable-experiments","tag":"28639b16-af86-4531-b8b5-2045dfd4a32a","ts":1632426930526}""",
        """{"deviceType":"experiment","dataType":"disable-experiments","tag":"28639b16-af86-4531-b8b5-2045dfd4a32a","ts":1632426930526}""",
        """{"deviceType":"sim","dataType":"sim-cheat-command","simAction":{"getAllObjectPoses":{},"setObjectPose":{"id":"test","poseXYZXYZW":[1,2,3,4,5,6,7]},"deleteObject":{"id":"test"},"setCameraIntrinsics":{"id":"test","intrinsics":[1],"nearClip":2,"farClip":3},"addObject":{"id":"test","type":"test","poseXYZXYZW":[1,2,3,4,5,6,7]},"getSegmentedImage":{"deviceKey":"test-key"}}}""",
    ]
    for test in tests:
      data_json = json.loads(test)
      data = types_gen.CommandData.from_json(data_json)
      self.assertEqual(data_json, data.to_json())
      proto = data.to_proto()
      loaded = logs_pb2.CommandData.FromString(proto.SerializeToString())
      self.assertEqual(proto, loaded)
      loaded_data = types_gen.CommandData.from_proto(loaded)
      self.assertEqual(data_json, loaded_data.to_json())


if __name__ == '__main__':
  unittest.main()
